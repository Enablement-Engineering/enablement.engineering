@import url('https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800&display=swap');
@tailwind base;
@tailwind components;
@tailwind utilities;

/* CSS Custom Properties for Brand Colors */
:root {
  /* Primary colors - Yellow as main brand color */
  --color-primary: #ffd60a;
  --color-primary-foreground: #0b0e14;

  /* Secondary colors - Black/Ink for text and content */
  --color-secondary: #0b0e14;
  --color-secondary-foreground: #f7f5f2;

  /* Accent colors - Orange for accents */
  --color-accent: #f97316;
  --color-accent-foreground: #0b0e14;

  /* Link colors - Teal for links only */
  --color-link: #0f766e;
  --color-link-foreground: #f7f5f2;

  /* Semantic colors */
  --color-background: #f7f5f2;
  --color-background-subtle: #ede8e1;
  --color-foreground: #0b0e14;
  --color-foreground-muted: #78716c;
  --color-card: #f7f5f2;
  --color-card-foreground: #0b0e14;
  --color-popover: #ffffff;
  --color-popover-foreground: #0b0e14;

  /* Muted colors */
  --color-muted: #ede8e1;
  --color-muted-foreground: #78716c;

  /* Border and input */
  --color-border: #ddd4c5;
  --color-input: #ddd4c5;
  --color-ring: #f97316;

  /* Destructive */
  --color-destructive: #ef4444;
  --color-destructive-foreground: #ffffff;

  /* Success */
  --color-success: #10b981;
  --color-success-foreground: #ffffff;

  /* Warning */
  --color-warning: #f59e0b;
  --color-warning-foreground: #ffffff;

  /* Spacing and sizing */
  --radius: 0.5rem;
  --font-family-sans: 'Manrope', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;

  /* Syntax highlighting - Light mode */
  --syntax-keyword: #0f766e;
  --syntax-string: #78350f;
  --syntax-function: #0f766e;
  --syntax-variable: #a16207;
  --syntax-property: #92400e;
  --syntax-constant: #b45309;
  --syntax-comment: #78716c;

  /* Selection */
  --selection-bg: rgba(255, 214, 10, 0.25);
}

/* Dark mode support */
.dark {
  /* Primary stays consistent for brand recognition */
  --color-primary: #ffd60a;
  --color-primary-foreground: #0b0e14;

  /* Accent shifts slightly lighter in dark mode */
  --color-accent: #fb923c;
  --color-accent-foreground: #0b0e14;

  /* Link color shifts to light teal */
  --color-link: #5eead4;
  --color-link-foreground: #1c1917;

  /* Core semantic colors - warm charcoal base */
  --color-background: #1c1917;
  --color-background-subtle: #292524;
  --color-foreground: #f5f5f4;
  --color-foreground-muted: #a8a29e;
  --color-card: #292524;
  --color-card-foreground: #f5f5f4;
  --color-popover: #292524;
  --color-popover-foreground: #f5f5f4;

  /* Muted colors */
  --color-muted: #292524;
  --color-muted-foreground: #a8a29e;

  /* Border and input */
  --color-border: #44403c;
  --color-input: #44403c;
  --color-ring: #fb923c;

  /* Syntax highlighting - Dark mode */
  --syntax-keyword: #d6a064;
  --syntax-string: #a3be8c;
  --syntax-function: #88c0d0;
  --syntax-variable: #ebcb8b;
  --syntax-property: #e7c08a;
  --syntax-constant: #ffd60a;
  --syntax-comment: #a8a29e;

  /* Selection */
  --selection-bg: rgba(255, 214, 10, 0.15);
}

/* Base layer styles */
@layer base {
  * {
    @apply border-border;
  }

  html {
    @apply scroll-smooth;
  }

  body {
    @apply bg-background text-foreground font-sans;
    font-feature-settings: "rlig" 1, "calt" 1;
  }

  /* Skip link accessibility styles - visually hidden until focused */
  .skip-link {
    @apply fixed top-4 left-4 bg-primary-400 text-secondary-900 px-4 py-2 font-medium rounded-md no-underline;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-1rem);
    transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
  }

  .skip-link:focus {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  /* Typography improvements */
  h1, h2, h3, h4, h5, h6 {
    @apply font-semibold leading-tight;
  }

  h1 {
    @apply text-4xl md:text-5xl lg:text-6xl;
  }

  h2 {
    @apply text-2xl md:text-3xl lg:text-4xl;
  }

  h3 {
    @apply text-xl md:text-2xl;
  }

  /* Focus styles for accessibility */
  *:focus-visible {
    @apply outline-none ring-2 ring-accent ring-offset-2 ring-offset-background;
  }

  /* Improved link styles - underlined by default for WCAG 1.4.1 compliance */
  a {
    color: var(--color-link);
    @apply transition-colors duration-200;
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--color-link) 50%, transparent);
    text-underline-offset: 2px;
  }

  a:hover {
    text-decoration-color: var(--color-link);
  }

  /* Remove underline from navigation, buttons, and card links */
  a.no-underline,
  nav a,
  a.block,
  a.inline-flex {
    text-decoration: none;
  }

  a.no-underline:hover,
  nav a:hover,
  a.block:hover,
  a.inline-flex:hover {
    text-decoration: none;
  }

  /* Selection styles */
  ::selection {
    background-color: var(--selection-bg);
    color: inherit;
  }
}

/* Component layer styles */
@layer components {
  /* Off-kilter utility classes from brand system */
  .off-kilter-1 {
    transform: rotate(1deg) translateZ(0);
    transform-origin: center;
    transition: transform 0.2s ease-out;
    will-change: transform;
  }

  .off-kilter-1:hover,
  .off-kilter-1:focus-within {
    transform: rotate(0deg) translateZ(0);
  }

  .off-kilter-neg-1 {
    transform: rotate(-1deg) translateZ(0);
    transform-origin: center;
    transition: transform 0.2s ease-out;
    will-change: transform;
  }

  .off-kilter-neg-1:hover,
  .off-kilter-neg-1:focus-within {
    transform: rotate(0deg) translateZ(0);
  }

  .off-kilter-0-5 {
    transform: rotate(0.5deg) translateZ(0);
    transform-origin: center;
    transition: transform 0.2s ease-out;
    will-change: transform;
  }

  .off-kilter-0-5:hover,
  .off-kilter-0-5:focus-within {
    transform: rotate(0deg) translateZ(0);
  }

  .off-kilter-neg-0-5 {
    transform: rotate(-0.5deg) translateZ(0);
    transform-origin: center;
    transition: transform 0.2s ease-out;
    will-change: transform;
  }

  .off-kilter-neg-0-5:hover,
  .off-kilter-neg-0-5:focus-within {
    transform: rotate(0deg) translateZ(0);
  }

  /* Grid utilities */
  .grid-container {
    @apply max-w-6xl mx-auto px-6 lg:px-8;
  }

  .grid-12 {
    @apply grid grid-cols-12 gap-6;
  }

  /* Button base styles */
  .btn-base {
    @apply inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50;
  }

  /* Card base styles */
  .card-base {
    @apply rounded-lg border bg-card text-card-foreground shadow-sm;
  }

  /* Input base styles */
  .input-base {
    @apply flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50;
  }

  /* Service grid with automatic row-based icon shapes */
  .service-grid {
    /* CSS custom properties for shape morphing */
    --square-outer: 0.5rem;
    --square-inner: 0.25rem;
    --circle-outer: 50%;
    --circle-inner: 50%;
    --transition: border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Base icon styling */
  .service-grid .service-icon {
    transition: var(--transition);
    will-change: border-radius;
  }

  .service-grid .service-icon > * {
    transition: var(--transition);
    will-change: border-radius;
  }

  /* Row 1, 3, 5... (odd rows) - Squares by default */
  .service-grid .service-card:nth-child(6n+1) .service-icon,
  .service-grid .service-card:nth-child(6n+2) .service-icon,
  .service-grid .service-card:nth-child(6n+3) .service-icon {
    border-radius: var(--square-outer);
  }

  .service-grid .service-card:nth-child(6n+1) .service-icon > *,
  .service-grid .service-card:nth-child(6n+2) .service-icon > *,
  .service-grid .service-card:nth-child(6n+3) .service-icon > * {
    border-radius: var(--square-inner);
  }

  /* Row 2, 4, 6... (even rows) - Circles by default */
  .service-grid .service-card:nth-child(6n+4) .service-icon,
  .service-grid .service-card:nth-child(6n+5) .service-icon,
  .service-grid .service-card:nth-child(6n+6) .service-icon {
    border-radius: var(--circle-outer);
  }

  .service-grid .service-card:nth-child(6n+4) .service-icon > *,
  .service-grid .service-card:nth-child(6n+5) .service-icon > *,
  .service-grid .service-card:nth-child(6n+6) .service-icon > * {
    border-radius: var(--circle-inner);
  }

  /* Hover/focus morphing - squares become circles */
  .service-grid .service-card:nth-child(6n+1):hover .service-icon,
  .service-grid .service-card:nth-child(6n+2):hover .service-icon,
  .service-grid .service-card:nth-child(6n+3):hover .service-icon,
  .service-grid .service-card:nth-child(6n+1):focus-within .service-icon,
  .service-grid .service-card:nth-child(6n+2):focus-within .service-icon,
  .service-grid .service-card:nth-child(6n+3):focus-within .service-icon {
    border-radius: var(--circle-outer);
  }

  .service-grid .service-card:nth-child(6n+1):hover .service-icon > *,
  .service-grid .service-card:nth-child(6n+2):hover .service-icon > *,
  .service-grid .service-card:nth-child(6n+3):hover .service-icon > *,
  .service-grid .service-card:nth-child(6n+1):focus-within .service-icon > *,
  .service-grid .service-card:nth-child(6n+2):focus-within .service-icon > *,
  .service-grid .service-card:nth-child(6n+3):focus-within .service-icon > * {
    border-radius: var(--circle-inner);
  }

  /* Hover/focus morphing - circles become squares */
  .service-grid .service-card:nth-child(6n+4):hover .service-icon,
  .service-grid .service-card:nth-child(6n+5):hover .service-icon,
  .service-grid .service-card:nth-child(6n+6):hover .service-icon,
  .service-grid .service-card:nth-child(6n+4):focus-within .service-icon,
  .service-grid .service-card:nth-child(6n+5):focus-within .service-icon,
  .service-grid .service-card:nth-child(6n+6):focus-within .service-icon {
    border-radius: var(--square-outer);
  }

  .service-grid .service-card:nth-child(6n+4):hover .service-icon > *,
  .service-grid .service-card:nth-child(6n+5):hover .service-icon > *,
  .service-grid .service-card:nth-child(6n+6):hover .service-icon > *,
  .service-grid .service-card:nth-child(6n+4):focus-within .service-icon > *,
  .service-grid .service-card:nth-child(6n+5):focus-within .service-icon > *,
  .service-grid .service-card:nth-child(6n+6):focus-within .service-icon > * {
    border-radius: var(--square-inner);
  }

  /* Responsive adjustments for smaller grids */
  @media (max-width: 1023px) {
    /* 2-column grid on tablet - every 4 items cycle */
    .service-grid .service-card:nth-child(4n+1) .service-icon,
    .service-grid .service-card:nth-child(4n+2) .service-icon {
      border-radius: var(--square-outer);
    }

    .service-grid .service-card:nth-child(4n+1) .service-icon > *,
    .service-grid .service-card:nth-child(4n+2) .service-icon > * {
      border-radius: var(--square-inner);
    }

    .service-grid .service-card:nth-child(4n+3) .service-icon,
    .service-grid .service-card:nth-child(4n+4) .service-icon {
      border-radius: var(--circle-outer);
    }

    .service-grid .service-card:nth-child(4n+3) .service-icon > *,
    .service-grid .service-card:nth-child(4n+4) .service-icon > * {
      border-radius: var(--circle-inner);
    }
  }

  @media (max-width: 767px) {
    /* 1-column grid on mobile - alternating items */
    .service-grid .service-card:nth-child(odd) .service-icon {
      border-radius: var(--square-outer);
    }

    .service-grid .service-card:nth-child(odd) .service-icon > * {
      border-radius: var(--square-inner);
    }

    .service-grid .service-card:nth-child(even) .service-icon {
      border-radius: var(--circle-outer);
    }

    .service-grid .service-card:nth-child(even) .service-icon > * {
      border-radius: var(--circle-inner);
    }
  }

  /* Process grid with simple alternating pattern */
  .process-grid .process-icon {
    transition: var(--transition);
    will-change: border-radius;
  }

  .process-grid .process-icon > * {
    transition: var(--transition);
    will-change: border-radius;
  }

  /* Alternating pattern: square, circle, square */
  .process-grid .process-step:nth-child(odd) .process-icon {
    border-radius: var(--square-outer);
  }

  .process-grid .process-step:nth-child(odd) .process-icon > * {
    border-radius: var(--square-inner);
  }

  .process-grid .process-step:nth-child(even) .process-icon {
    border-radius: var(--circle-outer);
  }

  .process-grid .process-step:nth-child(even) .process-icon > * {
    border-radius: var(--circle-inner);
  }

  /* Hover morphing for process icons */
  .process-grid .process-step:nth-child(odd):hover .process-icon,
  .process-grid .process-step:nth-child(odd):focus-within .process-icon {
    border-radius: var(--circle-outer);
  }

  .process-grid .process-step:nth-child(odd):hover .process-icon > *,
  .process-grid .process-step:nth-child(odd):focus-within .process-icon > * {
    border-radius: var(--circle-inner);
  }

  .process-grid .process-step:nth-child(even):hover .process-icon,
  .process-grid .process-step:nth-child(even):focus-within .process-icon {
    border-radius: var(--square-outer);
  }

  .process-grid .process-step:nth-child(even):hover .process-icon > *,
  .process-grid .process-step:nth-child(even):focus-within .process-icon > * {
    border-radius: var(--square-inner);
  }

  /* Performance optimization for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .service-grid,
    .process-grid {
      --transition: none;
    }

    .service-grid .service-icon,
    .service-grid .service-icon > *,
    .process-grid .process-icon,
    .process-grid .process-icon > * {
      transition: none;
      will-change: auto;
    }
  }
}

/* Prose/Typography overrides for better contrast */
@layer components {
  /* Code block styling - Light mode (Parchment Light theme) */
  .prose pre {
    background-color: var(--color-background-subtle);
    border: 1px solid var(--color-border);
    @apply rounded-lg shadow-sm;
    color: var(--color-foreground);
  }

  .prose pre code {
    color: inherit;
    background: transparent !important;
  }

  .prose :where(pre code):not(:where([class~="not-prose"],[class~="not-prose"] *)) {
    color: inherit;
  }

  /* Inline code styling */
  .prose code {
    background-color: var(--color-background-subtle);
    color: var(--color-foreground);
    @apply px-1.5 py-0.5 rounded text-sm font-mono;
  }

  .prose code::before,
  .prose code::after {
    content: none;
  }

  /* Shiki code block theme override for dark mode */
  .dark .prose pre,
  .dark .astro-code,
  .dark pre.astro-code {
    background-color: var(--color-background-subtle) !important;
    border-color: var(--color-border);
  }

  /* Override Shiki inline styles in dark mode */
  .dark .astro-code span,
  .dark pre.astro-code span {
    color: var(--shiki-dark, inherit) !important;
  }

  /* Table overflow handling for mobile */
  .prose table {
    @apply block overflow-x-auto whitespace-nowrap;
  }

  @media (min-width: 640px) {
    .prose table {
      @apply table whitespace-normal;
    }
  }
}

/* Utility layer styles */
@layer utilities {
  /* Text color utilities */
  .text-ink {
    color: var(--color-foreground);
  }

  .text-paper {
    color: var(--color-background);
  }

  /* Background color utilities */
  .bg-paper {
    background-color: var(--color-background);
  }

  .bg-ink {
    background-color: var(--color-foreground);
  }

  /* Animation utilities */
  .animate-fade-in-up {
    animation: fadeInUp 0.5s ease-out forwards;
  }

  .animate-stagger-1 {
    animation-delay: 0.1s;
  }

  .animate-stagger-2 {
    animation-delay: 0.2s;
  }

  .animate-stagger-3 {
    animation-delay: 0.3s;
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .animate-fade-in-up,
    .animate-stagger-1,
    .animate-stagger-2,
    .animate-stagger-3 {
      animation: none;
    }

    .off-kilter-1,
    .off-kilter-neg-1,
    .off-kilter-0-5,
    .off-kilter-neg-0-5 {
      transform: none;
      transition: none;
      will-change: auto;
    }

    .off-kilter-1:hover,
    .off-kilter-1:focus-within,
    .off-kilter-neg-1:hover,
    .off-kilter-neg-1:focus-within,
    .off-kilter-0-5:hover,
    .off-kilter-0-5:focus-within,
    .off-kilter-neg-0-5:hover,
    .off-kilter-neg-0-5:focus-within {
      transform: none;
    }
  }
}

/* Sun component animations */
@layer base {
  .sun-morphing {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .sun-hover-pulse:hover {
    animation: sunPulse 1.5s infinite;
  }

  .sun-hover-rotate:hover {
    animation: sunRotate 2s linear infinite;
  }

  .sun-hover-morph:hover {
    transform: scale(1.1) rotate(15deg);
    filter: drop-shadow(0 4px 8px rgba(255, 214, 10, 0.3));
  }

  @keyframes sunPulse {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.05);
      opacity: 0.9;
    }
  }

  @keyframes sunRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* Sun variant switching animations */
  .sun-switching {
    transition: opacity 0.3s ease-in-out;
  }

  .sun-fade-enter {
    opacity: 0;
    transform: scale(0.8);
  }

  .sun-fade-enter-active {
    opacity: 1;
    transform: scale(1);
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
  }

  .sun-fade-exit {
    opacity: 1;
    transform: scale(1);
  }

  .sun-fade-exit-active {
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
  }

  /* Sun morph on hover - base transition for hover morph feature
   * Note: Full circle-to-sloppy morph implementation is WIP due to
   * SVG transform origin conflicts. Currently provides smooth transition. */
  .sun-morph-on-hover {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Performance optimization for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .sun-morphing,
    .sun-hover-pulse,
    .sun-hover-rotate,
    .sun-hover-morph,
    .sun-morph-on-hover,
    .sun-switching,
    .sun-fade-enter,
    .sun-fade-enter-active,
    .sun-fade-exit,
    .sun-fade-exit-active {
      transition: none;
      animation: none;
      transform: none;
      filter: none;
    }
  }
}
