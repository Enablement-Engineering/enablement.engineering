---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
	const isDev = import.meta.env.DEV;
	const writingEntries = await getCollection('writing', ({ data }) => {
		// In production, filter out drafts; in dev, show all
		if (isDev) return true;
		return data.draft !== true;
	});
	return writingEntries.map(entry => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', {
		year: 'numeric',
		month: 'long',
		day: 'numeric'
	});
}

const typeLabels = {
	essay: 'Essay',
	'prompt-lab': 'Prompt Lab',
	'case-study': 'Case Study',
	note: 'Note',
};

const typeColors = {
	essay: 'bg-primary-100 text-primary-700',
	'prompt-lab': 'bg-accent-100 text-accent-700',
	'case-study': 'bg-secondary-100 text-secondary-700',
	note: 'bg-neutral-100 text-neutral-700',
};
---

<Layout title={`${entry.data.title} | Writing | Enablement Engineering`} description={entry.data.description}>
	<article class="py-16 lg:py-24">
		<div class="max-w-3xl mx-auto">
			<!-- Header -->
			<header class="mb-12">
				<button
					onclick="history.length > 1 ? history.back() : window.location.href = '/writing'"
					class="inline-flex items-center text-neutral-500 hover:text-neutral-700 mb-6 group cursor-pointer bg-transparent border-none p-0"
				>
					<svg class="w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
					</svg>
					Back
				</button>

				<div class="mb-4 flex items-center gap-2">
					<span class={`inline-block px-3 py-1 text-sm font-medium rounded-full ${typeColors[entry.data.type]}`}>
						{typeLabels[entry.data.type]}
					</span>
					{entry.data.draft && (
						<span class="inline-block px-3 py-1 text-sm font-medium rounded-full bg-amber-100 text-amber-700 uppercase">
							Draft
						</span>
					)}
				</div>

				<h1 class="text-3xl lg:text-4xl font-bold text-ink mb-4 leading-tight">
					{entry.data.title}
				</h1>

				<p class="text-xl text-neutral-600 mb-6">
					{entry.data.description}
				</p>

				<div class="flex items-center gap-4 text-sm text-neutral-500">
					<time datetime={entry.data.publishedAt.toISOString()}>
						{formatDate(entry.data.publishedAt)}
					</time>
					{entry.data.modifiedAt && (
						<>
							<span>•</span>
							<span>Updated {formatDate(entry.data.modifiedAt)}</span>
						</>
					)}
				</div>
			</header>

			<!-- Content -->
			<div class="prose prose-lg prose-neutral max-w-none
				prose-headings:text-ink prose-headings:font-bold
				prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-4
				prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
				prose-p:text-neutral-700 prose-p:leading-relaxed
				prose-a:text-link-600 prose-a:underline prose-a:decoration-link/50 prose-a:underline-offset-2 hover:prose-a:decoration-link
				prose-strong:text-ink
				prose-em:text-neutral-700
				prose-code:bg-neutral-100 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:font-mono
				prose-pre:bg-secondary-900 prose-pre:text-neutral-100 prose-pre:overflow-x-auto
				prose-blockquote:border-l-primary-400 prose-blockquote:bg-neutral-50 prose-blockquote:py-1 prose-blockquote:px-4 prose-blockquote:rounded-r-lg prose-blockquote:not-italic
				prose-ul:list-disc prose-ul:pl-6
				prose-ol:list-decimal prose-ol:pl-6
				prose-li:text-neutral-700
				prose-hr:border-neutral-200
			">
				<Content />
			</div>

			<!-- Tags -->
			{entry.data.tags && entry.data.tags.length > 0 && (
				<div class="mt-12 pt-8 border-t border-neutral-200">
					<div class="flex flex-wrap gap-2">
						{entry.data.tags.map((tag) => (
							<span class="px-3 py-1 bg-neutral-100 text-neutral-600 text-sm rounded-full">
								{tag}
							</span>
						))}
					</div>
				</div>
			)}

			<!-- Author -->
			<div class="mt-12 pt-8 border-t border-neutral-200">
				<div class="flex items-start gap-4">
					<img src="/me.jpg" alt="Dylan Isaac" class="w-12 h-12 rounded-full object-cover flex-shrink-0" />
					<div>
						<p class="font-semibold text-ink">Dylan Isaac</p>
						<p class="text-neutral-600 text-sm">
							Enablement engineer. I design orchestration layers that turn AI capability into human flourishing.
						</p>
						<a href="/about" class="text-link-600 text-sm mt-2 inline-block">
							More about me →
						</a>
					</div>
				</div>
			</div>

			<!-- Related CTA -->
			<div class="mt-12 p-8 bg-neutral-50 rounded-2xl">
				<h2 class="text-xl font-bold text-ink mb-4">
					Interested in working together?
				</h2>
				<p class="text-neutral-600 mb-6">
					If this resonates with the challenges you're facing, let's talk about how enablement engineering could help.
				</p>
				<div class="flex flex-col sm:flex-row gap-4">
					<a href="/services" class="inline-flex items-center justify-center whitespace-nowrap rounded-lg font-semibold bg-primary-400 text-secondary-900 hover:bg-primary-300 h-11 px-6 no-underline text-sm">
						View Services
					</a>
					<a href="/contact" class="inline-flex items-center justify-center whitespace-nowrap rounded-lg font-semibold bg-secondary-900 text-neutral-50 hover:bg-secondary-800 h-11 px-6 no-underline text-sm">
						Start a Conversation
					</a>
				</div>
			</div>
		</div>
	</article>
</Layout>
